webpackJsonp([2],{"1Duw":function(e,t,a){var n=a("Vi+6");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("8bSs")("681837ee",n,!0)},"60Rz":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("aA9S"),i=a.n(n),r=a("L9TO"),o=a("xE3b"),s=a("tyP1"),l={data:function(){return{action:"/api/image/uploadfile",ruleForm:{id:"",title:"",images:[],newsKey:"",detail:"",newsNo:""},rules:{images:[{type:"array",required:!0,trigger:"change",message:"请上传图片"}],title:[{required:!0,trigger:"blur",message:"请输入资讯标题"}],newsKey:[{required:!0,trigger:"blur",message:"请输入关键字"}],detail:[{required:!0,trigger:"blur",message:"请添加资讯详情"}]},editorSetting:{width:600,height:400}}},computed:{isEdit:function(){return this.$route.query&&this.$route.query.id}},created:function(){var e=this.$route.query&&this.$route.query.id;e&&this.getNewsEditInfo(e)},methods:{handleDelImg:function(e,t){this.ruleForm.images.splice(t)},handleAvatarSuccess:function(e,t){console.log("图片上传返回：",e,t),this.ruleForm.images.push({goodPath:e.data,localPath:URL.createObjectURL(t.raw)})},beforeAvatarUpload:function(e){var t=e.size/1024/1024<2;return t||this.$message.error("上传图片大小不能超过 2MB!"),t},getNewsEditInfo:function(e){var t=this;this.listLoading=!0,Object(r.i)(e).then(function(e){if(t.listLoading=!1,e.data){var a=e.data;t.ruleForm={id:a.id,title:a.title,images:a.images,newsKey:a.newsKey,detail:a.detail,newsNo:a.newsNo}}})},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var a=i()({},t.ruleForm),n=[];a.images.map(function(e){return e.goodPath.indexOf("https")>-1&&(e.localPath=e.goodPath,e.goodPath=/https:\/\/image.le-99.xyz\/(images\/\w+\.\w+)(\?\w+)/.exec(e.goodPath)[1]),n.push({localPath:e.localPath,goodPath:e.goodPath}),e}),a.images=n,t.isEdit?Object(r.f)(a).then(function(e){200==e.code&&(t.$message({message:"修改成功",type:"success"}),setTimeout(function(){t.$router.push({name:"news-list"})},1e3))}):Object(r.b)(a).then(function(e){200==e.code&&(t.$message({message:"添加成功",type:"success"}),setTimeout(function(){t.$router.push({name:"news-list"})},1e3))})})},cancel:function(){this.$router.back(-1)}},components:{TitleLine:o.a,editor:s.a}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("title-line",{attrs:{txt:e.ruleForm.id?"编辑资讯":"新建资讯"}}),e._v(" "),a("el-form",{ref:"ruleForm",staticClass:"form",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"130px"}},[e.isEdit?a("el-form-item",{staticStyle:{width:"312px"},attrs:{label:"资讯编号",prop:"newsNo"}},[a("el-input",{attrs:{disabled:e.isEdit},model:{value:e.ruleForm.newsNo,callback:function(t){e.$set(e.ruleForm,"newsNo",t)},expression:"ruleForm.newsNo"}})],1):e._e(),e._v(" "),a("el-form-item",{staticStyle:{width:"312px"},attrs:{label:"资讯标题",prop:"title"}},[a("el-input",{model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"资讯图片",prop:"images"}},[e._l(e.ruleForm.images,function(t,n){return a("span",{key:n,staticClass:"news-img"},[a("i",{staticClass:"del-btn el-icon-remove",on:{click:function(a){e.handleDelImg(t,n)}}}),e._v(" "),a("img",{attrs:{src:t.localPath||t.goodPath,alt:"图片"}})])}),e._v(" "),a("el-upload",{staticClass:"avatar-uploader",attrs:{multiple:!0,"with-credentials":!0,"show-file-list":!1,action:e.action,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],2),e._v(" "),a("el-form-item",{staticStyle:{width:"312px"},attrs:{label:"资讯关键字",prop:"newsKey"}},[a("el-input",{model:{value:e.ruleForm.newsKey,callback:function(t){e.$set(e.ruleForm,"newsKey",t)},expression:"ruleForm.newsKey"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"312px"},attrs:{label:"资讯详情",prop:"details"}},[a("editor",{staticClass:"editor",attrs:{value:e.ruleForm.detail,setting:e.editorSetting},on:{input:function(t){return e.ruleForm.detail=t}}})],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["news-add-cancel"],expression:"['news-add-cancel']"}],attrs:{type:"info"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["news-add-publish"],expression:"['news-add-publish']"}],attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("发布")])],1)],1)],1)},staticRenderFns:[]};var u=a("vSla")(l,d,!1,function(e){a("1Duw")},"data-v-38e3bdd5",null);t.default=u.exports},"Vi+6":function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"\n.app-container[data-v-38e3bdd5] {\n  padding-left: 50px;\n}\n.app-container .title[data-v-38e3bdd5] {\n    font-size: 30px;\n    color: #606266;\n}\n.app-container .form[data-v-38e3bdd5] {\n    margin-top: 30px;\n    padding: 30px;\n    padding-bottom: 5px;\n    background: #f2f6fc;\n}\n.app-container .form .btn[data-v-38e3bdd5] {\n      margin-top: 30px;\n}\n.avatar-uploader .el-upload[data-v-38e3bdd5] {\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n.avatar-uploader .el-upload[data-v-38e3bdd5]:hover {\n  border-color: #409eff;\n}\n.avatar-uploader-icon[data-v-38e3bdd5] {\n  font-size: 28px;\n  color: #8c939d;\n  width: 120px;\n  height: 120px;\n  line-height: 120px;\n  text-align: center;\n  background: #fff;\n}\n.avatar[data-v-38e3bdd5] {\n  width: 120px;\n  height: 120px;\n  display: block;\n}\n.news-img[data-v-38e3bdd5] {\n  width: 120px;\n  height: 120px;\n  float: left;\n  margin: 0 10px 10px 0;\n  position: relative;\n}\n.news-img .del-btn[data-v-38e3bdd5] {\n    position: absolute;\n    top: -8px;\n    right: -8px;\n    font-size: 20px;\n}\n.news-img img[data-v-38e3bdd5] {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n",""])}});